---
title: "PRAKTIKUM 1_MPDW_QINDYNAURA"
author: "Qindy Naura"
date: "2025-08-31"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## **MEMANGGIL LIBRARY YANG DIPERLUKAN**
```{r}
library("forecast")
library("graphics")
library("TTR")
library("TSA")
library("rio")
library("readr")
library("readxl")
```

## IMPORT DATA FILE

Data yang digunakan berisi data Cuaca yang dicatat setiap 10 menit sepanjang tahun 2020, mencakup 20 indikator meteorologi yang diukur di stasiun cuaca Max Planck Institute. Variabel yang akan digunakan nantinya adalah VPdef yaitu defisit tekanan uap dalam milibar(mbar) sebagai peubah y dan date (periode)sebagai peubah x\

```{r}
library("dplyr")
library("lubridate")
data1 <- read.csv("C:\\Users\\ASUS R3\\Downloads\\Kel2_Data fix Proyek_VPdef.csv")
data1$periode <- as.POSIXct(data1$date, format = "%m/%d/%Y %H:%M")
```

## MENGECEK APAKAH ADA DATA YANG HILANG 

```{r}
library(dplyr)
library(lubridate)

# Buat grid waktu lengkap
start <- min(data1$periode)
end   <- max(data1$periode)

full_seq <- tibble(
  row_id  = 1:length(seq(from = start, to = end, by = "10 mins")),
  periode = seq(from = start, to = end, by = "10 mins")
)

# Cek data duplikat
duplikat_ts <- data1 %>%
  count(periode) %>%
  filter(n > 1) %>%
  mutate(
    tgl = as.Date(periode),
    jam = format(periode, "%H:%M"),
    masalah = paste0("Duplikat (", n, "x)")
  )

# Cek data yang hilang
missing_ts <- anti_join(full_seq, data1, by = "periode") %>%
  mutate(
    tgl = as.Date(periode),
    jam = format(periode, "%H:%M"),
    masalah = "Hilang"
  )

# Gabung duplikat & missing
cek_ts <- bind_rows(
  duplikat_ts %>% select(periode, tgl, jam, masalah),
  missing_ts   %>% select(periode, tgl, jam, masalah)
) %>%
  arrange(periode)

# Ringkas per tanggal
summary_ts <- cek_ts %>%
  group_by(tgl) %>%
  summarise(
    jumlah_masalah = n(),
    detail = paste0(jam, " (", masalah, ")", collapse = ", ")
  )

summary_ts2 <- summary_ts %>%
  mutate(
    hilang   = stringr::str_extract_all(detail, "[0-9]{2}:[0-9]{2}(?= \\(Hilang\\))"),
    duplikat = stringr::str_extract_all(detail, "[0-9]{2}:[0-9]{2}(?= \\(Duplikat.*?\\))")
  ) %>%
  mutate(
    hilang   = sapply(hilang, paste, collapse = ", "),
    duplikat = sapply(duplikat, paste, collapse = ", ")
  ) %>%
  select(tgl, jumlah_masalah, hilang, duplikat)
 View(summary_ts2)
```

Ada duplikat data tanggal 12 Mei jam 06.00 dan missing data 29 Mei sebanyak 9\

## SELECT KOLOM YANG DIPERLUKAN
Kolom yang dipilih adalah kolom date dan VPdef baris 101-200. Data baris ini aman dari data yang hilang\

```{r}
library(dplyr)
data1fix <- data1 %>%
  select(periode, VPdef)
datafix <- data1fix[101:200, ] 
```

## EKSPLORASI DATA
```{r}
View(datafix) # Menampilkan data
str(datafix) # Melihat struktur data
dim(datafix) # Melihat dimensi data
```
**Ubah datafix ke data timeseries**
```{r}
datafix.ts <- ts(datafix$VPdef)
summary(datafix.ts)
```

**Buat plot deret waktu**
```{r}
ts.plot(datafix.ts, xlab="periode", ylab="VPdef", 
        main = "Time Series Plot")
points(datafix.ts)
```

Berdasarkan plot data tersebut dapat terlihat bahwa defisit tekanan uap awal mulanya sangat tinggi kemudian mulai menurun secara cepat(cukup tajam) sampai di x sekitar 25-30. Kemudian setelah itu pola data mulai naik turun dengan fluktuasi yang kecil (cenderung stabil). Kemudian menjelang x=100 data mulai naik. Secara garis besar pola datanya adalah trend menurun diawal->fluktuasi kecil. Sehingga akan dilihat peramalannya menggunakan Single Moving Average, Double Moving Average dan Double Eksponensial Smoothing. Kemudian akan dilihat peramalan mana yang lebih relevan dan aman untuk data.\


## SINGLE MOVING AVERAGE & DOUBLE MOVING AVERAGE

### PEMBAGIAN DATA
Data dibagi menjadi data latih dan uji. 

```{r}
training_ma <- datafix[1:80,]
testing_ma <- datafix[81:100,]
train_ma.ts <- ts(training_ma$VPdef)
test_ma.ts <- ts(testing_ma$VPdef)
```

## EKSPLORASI
```{r}
#eksplorasi keseluruhan data
plot(datafix.ts, col="red",main="Plot semua data")
points(datafix.ts)

#eksplorasi data latih
plot(train_ma.ts, col="blue",main="Plot data latih")
points(train_ma.ts)

#eksplorasi data uji
plot(test_ma.ts, col="blue",main="Plot data uji")
points(test_ma.ts)
```

```{r}
#Eksplorasi dengan GGPLOT
library(ggplot2)
ggplot() + 
  geom_line(data = training_ma, aes(x = periode, y = VPdef, col = "Data Latih")) +
  geom_line(data = testing_ma, aes(x = periode, y = VPdef, col = "Data Uji")) +
  labs(x = "Periode Waktu", y = "VPdef", color = "Legend") +
  scale_colour_manual(name="Keterangan:", breaks = c("Data Latih", "Data Uji"),
                      values = c("blue", "red")) + 
  theme_bw() + theme(legend.position = "bottom",
                     plot.caption = element_text(hjust=0.5, size=12))
```

### Single Moving Avrage
Akan digunakan m=6 
```{r}
data.sma<-SMA(train_ma.ts, n=6)
data.sma
```
```{r}
data.ramal<-c(NA,data.sma)
data.ramal #forecast 1 periode ke depan
```
Melakukan peramalan untuk 20 periode ke depan dengan menggunakan data pemulusan ke-t sebagai peramalam periode ke-t+1
```{r}
data.gab<-cbind(aktual=c(train_ma.ts,rep(NA,20)),pemulusan=c(data.sma,rep(NA,20)),ramalan=c(data.ramal,rep(data.ramal[length(data.ramal)],19)))
data.gab
```

**Membuat plot perbandingan data asli dengan data pemulusan dan peramalan**
```{r}
ts.plot(datafix.ts, xlab="Time Period ", ylab="VPdef", main= "SMA N=6 Data VPdef")
points(datafix.ts)
lines(data.gab[,2],col="green",lwd=2)
lines(data.gab[,3],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","green","red"), cex=0.5)
```

### Hitung keakuratan

Pertama hitung keakuratan data latih
```{r}
#Menghitung nilai keakuratan data latih
error_train.sma = train_ma.ts-data.ramal[1:length(train_ma.ts)]
SSE_train.sma = sum(error_train.sma[7:length(train_ma.ts)]^2)
MSE_train.sma = mean(error_train.sma[7:length(train_ma.ts)]^2)
MAPE_train.sma = mean(abs((error_train.sma[7:length(train_ma.ts)]/train_ma.ts[7:length(train_ma.ts)])*100))

akurasi_train.sma <- matrix(c(SSE_train.sma, MSE_train.sma, MAPE_train.sma))
row.names(akurasi_train.sma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.sma) <- c("Akurasi m = 6")
akurasi_train.sma
```

```{r}
#Menghitung nilai keakuratan data uji
error_test.sma = test_ma.ts-data.gab[81:100,3]
SSE_test.sma = sum(error_test.sma^2)
MSE_test.sma = mean(error_test.sma^2)
MAPE_test.sma = mean(abs((error_test.sma/test_ma.ts*100)))

akurasi_test.sma <- matrix(c(SSE_test.sma, MSE_test.sma, MAPE_test.sma))
row.names(akurasi_test.sma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.sma) <- c("Akurasi m = 6")
akurasi_test.sma
```

Keakuratan data latih memiliki MAPE sebesar 17.78% dan untuk data uji memiliki MAPE 19.28%. Nilai MAPE ini masih masuk dalam kategori bagus untuk peramalan data ini. Setelah mencoba beberapa m yang cocok adalah m=6, untuk m yang lain bisa menghasilkan MAPE yang sangat besar atau overfiting.\
Eksplorasi dan peramalan akan dilanjutkan dengan DMA untuk melihat hasilnya.\

### DMA( Duble single smoothing)
m yang digunakan adalah 6, data yang sebelumnya sudah dilakukan smoothing akan dismoothing kembali 1x sehingga dihasilkan data hasil double smoothing.\
```{r}
dma <- SMA(data.sma, n = 6)
At <- 2*data.sma - dma
Bt <- 2/(6-1)*(data.sma - dma)
data.dma<- At+Bt
data.ramal2<- c(NA, data.dma)

t = 1:20
f = c()

for (i in t) {
  f[i] = At[length(At)] + Bt[length(Bt)]*(i)
}

data.gab2 <- cbind(aktual = c(train_ma.ts,rep(NA,20)), pemulusan1 = c(data.sma,rep(NA,20)),pemulusan2 = c(data.dma, rep(NA,20)),At = c(At, rep(NA,20)), Bt = c(Bt,rep(NA,20)),ramalan = c(data.ramal2, f[-1]))
data.gab2
```

Berikutnya membuat plot untuk data aktual, data hasil smoothing dan data peramalan\
```{r}
ts.plot(datafix.ts, xlab="Time Period ", ylab="VPdef", main= "DMA N=6 Data VPdef")
points(datafix.ts)
lines(data.gab2[,3],col="green",lwd=2)
lines(data.gab2[,6],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","green","red"), cex=0.8)

```

### Hitung keakuratan DMA

```{r}
#Menghitung nilai keakuratan data latih
error_train.dma = train_ma.ts-data.ramal2[1:length(train_ma.ts)]
SSE_train.dma = sum(error_train.dma[12:length(train_ma.ts)]^2)
MSE_train.dma = mean(error_train.dma[12:length(train_ma.ts)]^2)
MAPE_train.dma = mean(abs((error_train.dma[12:length(train_ma.ts)]/train_ma.ts[12:length(train_ma.ts)])*100))

akurasi_train.dma <- matrix(c(SSE_train.dma, MSE_train.dma, MAPE_train.dma))
row.names(akurasi_train.dma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.dma) <- c("Akurasi m = 6")
akurasi_train.dma
```
Untuk data latih didapatkan akurasi nilai MAPE 15.63%, SSE 0.418 dan MSE 0.0061. Berdasarkan nilai ini untuk data latih peramalan dengan DMA masuk dalam kategori yang baik.\

```{r}
#Menghitung nilai keakuratan data uji
error_test.dma = test_ma.ts-data.gab2[81:100,6]
SSE_test.dma = sum(error_test.dma^2)
MSE_test.dma = mean(error_test.dma^2)
MAPE_test.dma = mean(abs((error_test.dma/test_ma.ts*100)))

akurasi_test.dma <- matrix(c(SSE_test.dma, MSE_test.dma, MAPE_test.dma))
row.names(akurasi_test.dma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.dma) <- c("Akurasi m = 6")
akurasi_test.dma
```
Untuk data latih didapatkan akurasi nilai MAPE 17.33%, SSE 0.219 dan MSE 0.011. Berdasarkan nilai ini untuk data uji peramalan dengan DMA masuk dalam kategori yang baik.\
Baik akurasi data latih maupun data uji memiliki nilai MAPE yang masuk dalam kategori bagus.

### Double exponential Smoothing (DES)

```{r}
training_des<-datafix[1:80,]
testing_des<-datafix[81:100,]
train.ts <- ts(training_des$VPdef)
test.ts <- ts(testing_des$VPdef)
```

```{r}
#Lamda=0.2 dan gamma=0.2
des.1<- HoltWinters(train.ts, gamma = FALSE, beta = 0.2, alpha = 0.2)
plot(des.1)

#ramalan
ramalandes1<- forecast(des.1, h=20)
ramalandes1

#Lamda=0.6 dan gamma=0.2
des.2<- HoltWinters(train.ts, gamma = FALSE, beta = 0.3, alpha = 0.6)
plot(des.2)

#ramalan
ramalandes2<- forecast(des.2, h=20)
ramalandes2
```

PLotkan antara data asli, latih dan uji
```{r}
#Visually evaluate the prediction
plot(datafix.ts)
lines(des.1$fitted[,1], lty=2, col="blue")
lines(ramalandes1$mean, col="red")
```
**Mencari Parameter optimum**
```{r}
#Lamda dan gamma optimum
des.opt<- HoltWinters(train.ts, gamma = FALSE)
des.opt
plot(des.opt)

#ramalan
ramalandesopt<- forecast(des.opt, h=20)
ramalandesopt
```

### Melakukan perhitungan akurasi pada data latih dan uji
```{r}
#Akurasi Data Training (latih)
ssedes.train1<-des.1$SSE
msedes.train1<-ssedes.train1/length(train.ts)
sisaandes1<-ramalandes1$residuals
head(sisaandes1)

mapedes.train1 <- sum(abs(sisaandes1[3:length(train.ts)]/train.ts[3:length(train.ts)])
                      *100)/length(train.ts)

akurasides.1 <- matrix(c(ssedes.train1,msedes.train1,mapedes.train1))
row.names(akurasides.1)<- c("SSE", "MSE", "MAPE")
colnames(akurasides.1) <- c("Akurasi lamda=0.2 dan gamma=0.2")
akurasides.1

ssedes.train2<-des.2$SSE
msedes.train2<-ssedes.train2/length(train.ts)
sisaandes2<-ramalandes2$residuals
head(sisaandes2)

mapedes.train2 <- sum(abs(sisaandes2[3:length(train.ts)]/train.ts[3:length(train.ts)])
                      *100)/length(train.ts)

akurasides.2 <- matrix(c(ssedes.train2,msedes.train2,mapedes.train2))
row.names(akurasides.2)<- c("SSE", "MSE", "MAPE")
colnames(akurasides.2) <- c("Akurasi lamda=0.6 dan gamma=0.3")
akurasides.2
```

Lamda 0.6 dan gamma 0.3 menghasilkan model yang lebih baik. Berikutnya akan dilihat untuk akurasi data uji.\

```{r}
#Akurasi Data Testing
selisihdes1<-ramalandes1$mean-testing_des$VPdef
selisihdes1

SSEtestingdes1<-sum(selisihdes1^2)
MSEtestingdes1<-SSEtestingdes1/length(testing_des$VPdef)
MAPEtestingdes1<-sum(abs(selisihdes1/testing_des$VPdef)*100)/length(testing_des$VPdef)

selisihdes2<-ramalandes2$mean-testing_des$VPdef
selisihdes2

SSEtestingdes2<-sum(selisihdes2^2)
MSEtestingdes2<-SSEtestingdes2/length(testing_des$VPdef)
MAPEtestingdes2<-sum(abs(selisihdes2/testing_des$VPdef)*100)/length(testing_des$VPdef)

selisihdesopt<-ramalandesopt$mean-testing_des$VPdef
selisihdesopt

SSEtestingdesopt<-sum(selisihdesopt^2)
MSEtestingdesopt<-SSEtestingdesopt/length(testing_des$VPdef)
MAPEtestingdesopt<-sum(abs(selisihdesopt/testing_des$VPdef)*100)/length(testing_des$VPdef)

akurasitestingdes <-
  matrix(c(SSEtestingdes1,MSEtestingdes1,MAPEtestingdes1,SSEtestingdes2,MSEtestingdes2,
           MAPEtestingdes2,SSEtestingdesopt,MSEtestingdesopt,MAPEtestingdesopt),
         nrow=3,ncol=3)
row.names(akurasitestingdes)<- c("SSE", "MSE", "MAPE")
colnames(akurasitestingdes) <- c("des ske1","des ske2","des opt")
akurasitestingdes
```
Berdasarkan hasil akurasi DES yang masuk dalam kategori bagus adalah model dengan lamda 0.2 dan gamma 0.2, karena menghasilkan MAPE untuk data latih sebesar 17.83% dan data uji sebesar 17.08%. Pada data latih memang hasil akurasi MAPE sangat bagus pada lamda 0.6 dan gamma 0.3 namun dengan nilai lamda dan gamma tersebut menghasilkan nilai MAPE yang sangat tinggi untuk data uji, sehingga overfitting. Maka jika ingin mengggunakan DES dalam peramalan data ini akan lebih cocok menggunakan lamda  0.2 dan gamma 0.2. Pencarian nilai lamda dan Gamma sudah dilakukan namun yanng paling baik adalah lamda 0.2 dan gamma 0.2.\

## **KESIMPULAN**
Pemulusan dan peramalan data dengan single moving average (SMA) menghasilkan nilai akurasi MAPE:19.23% untuk data uji dan 17.77% untuk data latih.\

Pemulusan dan peramalan data dengan double moving average(DMA) menghasilkan nilai akurasi MAPE: 17.33% untuk data uji dan 15.33% untuk data latih.\

Peramalan dengan double exponential smoothing (DES) menghasilkan nilai akurasi MAPE: 17.08% untuk data uji dan 17.83% untuk data latih.\

Berdasarkan ketiga metode tersebut dalam melakukan peramalan pada data defisit tekanan uap ini diketahui bahwa baik SMA, DMA dan DES masih akurat dalam melakukan peramalan dilihat dari nilai MAPE nya yang masih kurang dari 20% atau masih masuk dalam kategori bagus. 














