---
title: "PRAKTIKUM 5_MPDW_QINDYNAURA"
author: "Qindy Naura"
date: "2025-09-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Memanggil Library
```{r}
library(forecast)
library(graphics)
library(TTR)
library(TSA)
library(rio)
library(readr)
library(readxl)
library(ggplot2)
library(tsibble)
library(MASS)
```

# Import Data File

Data yang digunakan berisi data Cuaca yang dicatat setiap 10 menit sepanjang tahun 2020, mencakup 20 indikator meteorologi yang diukur di stasiun cuaca Max Planck Institute. Variabel yang akan digunakan nantinya adalah VPdef yaitu defisit tekanan uap dalam milibar(mbar) sebagai peubah y dan date (periode)sebagai peubah x\

```{r}
library("dplyr")
library("lubridate")
data1 <- rio::import("https://raw.githubusercontent.com/QINDYNAURA/MPDW/main/Kel2_Data%20fix%20Proyek_VPdef.csv")
data1$periode <- as.POSIXct(data1$date, format = "%m/%d/%Y %H:%M")
str(data1)
data1
```

# Mengambil Data yang diperlukan
Berikutnya akan diselect baris dan kolom yang diperlukan. Baris yang diambil dari 101-200 dengan kolom periode dan VPdef.\

```{r}
library(dplyr)
data1fix <- data1 %>%
  select(periode, VPdef)
datafix <- data1fix[101:200, ] 
```

# Ekplorasi
## Plot Data Penuh

```{r}
datafix.ts <- ts(datafix$VPdef)

datafix_tsibble <- as_tsibble(datafix.ts)

plot_vpdef <- datafix_tsibble |>
  ggplot(aes(x = index, y = value)) +
  geom_line(color = "orange") +
  theme_bw() +
  xlab("Periode") +
  ylab("Nilai VPdef")
plot_vpdef
mean(datafix.ts)
```

Berdasarkan plot data tersebut dapat terlihat bahwa defisit tekanan uap awal mulanya sangat tinggi kemudian mulai menurun secara cepat(cukup tajam) sampai di x sekitar 25-30. Kemudian setelah itu pola data mulai naik turun dengan fluktuasi yang kecil (cenderung stabil). Kemudian menjelang x=100 data mulai naik. Secara garis besar pola datanya adalah trend menurun diawal->fluktuasi kecil.\

```{r}
lattice::densityplot(as.vector(datafix.ts))
```

Plot densitas di atas menunjukkan sebagian besar nilai data terkonsentrasi pada rentang sekitar 0,3â€“0,6 dengan penurunan kepadatan pada nilai yang lebih tinggi.\

## Plot Data Latih
Berdasarkan plot data secara keseluruhan pada data awal terlihat bahwa data tidak stasioner, untuk itu dilakukan split data sebagai berikut.\

```{r}
trainvpdef <- datafix[1:70,] # data latih, data ini akan dijadikan sebagai data latih
trainvpdef.ts <- ts(trainvpdef$VPdef)
plot.ts(trainvpdef.ts, lty=1, xlab="periode", ylab="VPdef", main="Plot VPdef")
```

## Plot Data Uji
```{r}
test<- datafix[71:100,] # data uji
test.ts <- ts(test$VPdef)
plot.ts(test.ts, lty=1, xlab="periode", ylab="VPdef", main="Plot VPdef")
```

## Uji Stasioneritas Data
### Stasioneritas dalam Rataan

Pengecekan stasioneritas dalam mean dilakukan dengan melihat plot ACF nya dan diperkuat dengan uji formal  Augmented Dickey-Fuller (ADF)\

```{r}
acf(trainvpdef.ts)
```

Berdasarkan plot ACF tersebut terlihat bahwa plot ACF data menurun secara lambat(**tails off**). Hal ini mengindikasikan bahwa data tidak stasioner dalam rataan.\

### Uji ADF

```{r}
tseries::adf.test(trainvpdef.ts)
```

$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.1894 yang lebih besar dari taraf nyata 5% sehingga tak tolak $H_0$ dan menandakan bahwa data tidak stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF, sehingga ketidakstasioneran model kedepannya harus ditangani.\

### Stasioneritas dalam Ragam
Berikutnya akan dicek stasioneritas data dalam ragam dengan menggunakan Box-cox.\

```{r}
index <- 1:length(trainvpdef.ts)
model <- lm(trainvpdef.ts ~ index)

# Plot Box-Cox
bc <- MASS::boxcox(model, lambda = seq(-2,2,0.1))

# Ambil lambda terbaik
lambda <- bc$x[which.max(bc$y)]
lambda

# Selang kepercayaan 95%
bc$x[bc$y > max(bc$y) - 0.5 * qchisq(0.95, 1)]
```
Berdasarkan grafik lamda tersebut angka 1 tidak masuk dalam selang hal ini mengindikasikan data tidak stasioner dalam ragam.\

# Penanganan
Penanganan pertama yang dilakukan adalah differencing untuk mengatasi data yang tak stasioner dalam rataan. Kemudian setelah itu dicek kembali stasioneritas dalam ragamnya.\

## Differencing
```{r}
train.diff<-diff(trainvpdef.ts,differences = 1) 
plot.ts(train.diff, lty=1, xlab="periode", ylab="Data Difference 1 VPdef", main="Plot Difference VPdef")
```

### Plot ACF data differencing
```{r}
acf(train.diff)
```

Berdasarkan plot ACF tersebut pola plot **cut off** di lag  1sehingga mengindikasikan data sudah stasioner dalam rataan.

### Uji ADF pada data differencing
```{r}
tseries::adf.test(train.diff)
```
$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.01413 yang lebih kecil dari taraf nyata 5% sehingga tolak $H_0$ atau data stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF. 

### Mengecek kembali kestasioneran dalam ragam 

Data setelah dilakukan differencing tadi dilakukan kembali pengecekan dalam ragam, agar data benar-benar stasioner.\

```{r}
index <- seq_along(train.diff)

# Uji Box-Cox
bc <- boxcox(
  (train.diff - min(train.diff) + 0.3) ~ index,
  lambda = seq(-1, 3, by = 0.1)
)

# Nilai lambda optimum
lambda <- bc$x[which.max(bc$y)]
lambda

# Batas bawah dan batas atas
ci_lower <- min(ci_lambda)
ci_upper <- max(ci_lambda)

c(Batas_Bawah = ci_lower, Batas_Atas = ci_upper)
```
Berdasarkan grafik lamda tersebut nilai 1 termasuk dalam selang lamdanya, sehingga data setelah differencing stasioner dalam ragam.
**Simpulan**: Ketaksioneran data dalam rataan dan ragam berhasil **ditangani dengan baik**. Selanjutnya data siap untuk diidentifikasi model. 
